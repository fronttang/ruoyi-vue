<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.electrical.danger.mapper.OwnerUnitDangerMapper">
    
    <resultMap type="OwnerUnitDanger" id="OwnerUnitDangerResult">
        <result property="id"    column="id"    />
        <result property="unitId"    column="unit_id"    />
        <result property="detectId"    column="detect_id"    />
        <result property="unitName"    column="unit_name"    />
        <result property="buildingId"    column="building_id"    />
        <result property="buildingName"    column="building_name"    />
        <result property="unitAreaId"    column="unit_area_id"    />
        <result property="areaName"    column="area_name"    />
        <result property="dangerId"    column="danger_id"    />
        <result property="formId"    column="form_id"    />
        <result property="formCode"    column="form_code"    />
        <result property="formType"    column="form_type"    />
        <result property="level"    column="level"    />
        <result property="description"    column="description"    />
        <result property="suggestions"    column="suggestions"    />
        <result property="location"    column="location"    />
        <result property="dangerPic"    column="danger_pic"    />
        <result property="status"    column="status"    />
        <result property="inspector"    column="inspector"    />
        <result property="inspectorId"    column="inspector_id"    />
        <result property="initialTime"    column="initial_time"    />
        <result property="formb"    column="formb"    />
        <result property="rectification"    column="rectification"    />
        <result property="rectificationDate"    column="rectification_date"    />
        <result property="reviewer"    column="reviewer"    />
        <result property="reviewerDate"    column="reviewer_date"    />
        <result property="rectificationPic"    column="rectification_pic"    />
        <result property="reason"    column="reason"    />
        <result property="detectPic"    column="detect_pic"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
    </resultMap>

    <sql id="selectOwnerUnitDangerVo">
        select d.id, d.unit_id, u.name as unit_name, u.detect_id, a.name as area_name, b.name as building_name, d.building_id, d.unit_area_id, d.danger_id, d.form_id, d.form_code, d.form_type, 
        d.level, d.description, d.suggestions, d.location, d.danger_pic, d.status, d.inspector, d.inspector_id, d.initial_time, 
        d.rectification, d.rectification_date, d.reviewer, d.reviewer_date, d.rectification_pic, d.reason, d.detect_pic, 
        d.create_by, d.create_time, d.update_by, d.update_time 
        from owner_unit_danger d 
        left join owner_unit u on u.id = d.unit_id
        left join owner_unit_area a on a.id = d.unit_area_id
        left join owner_unit_building b on b.id = d.building_id
    </sql>

    <select id="selectOwnerUnitDangerList" parameterType="OwnerUnitDanger" resultMap="OwnerUnitDangerResult">
        <include refid="selectOwnerUnitDangerVo"/>
        <where>  
            <if test="location != null  and location != ''"> 
            and (d.location like concat('%', #{location}, '%') 
            or u.name like concat('%', #{location}, '%')
            or a.name like concat('%', #{location}, '%')
            or b.name like concat('%', #{location}, '%')
            )
            </if>
            <if test="status != null  and status != ''"> and d.status = #{status}</if>
            <if test="projectId != null  and projectId != ''"> and u.project_id = #{projectId}</if>
            <if test="level != null  and level != ''"> and d.level = #{level}</if>
            <if test="buildingId != null  and buildingId != ''"> and d.building_id = #{buildingId}</if>
            <if test="unitId != null  and unitId != ''"> and d.unit_id = #{unitId}</if>
            <if test="level != null  and level != ''"> and d.level = #{level}</if>
            <if test="initialTime != null"> and date(d.initial_time) = #{initialTime}</if>
        </where>
    </select>
    
    <select id="selectOwnerUnitDangerById" parameterType="Long" resultMap="OwnerUnitDangerResult">
        <include refid="selectOwnerUnitDangerVo"/>
        where d.id = #{id}
    </select>
    
    <select id="selecOwnerUnitBuildingDict" parameterType="Long" resultType="com.ruoyi.electrical.vo.DictVO">
        select b.id, b.name from owner_unit_building b where b.unit_id = #{unitId}
    </select>

    
</mapper>